<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Virtual Neurology OPD | Dr Nisa Rasani</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial,sans-serif;background:#f4f6f8;padding:15px}
.container{max-width:820px;margin:auto;background:#fff;padding:25px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.1)}
h2,h3{text-align:center;color:#003366}
label{display:block;margin-top:12px;font-weight:bold}
input,select,button{width:100%;padding:10px;margin-top:6px}
button{background:#003366;color:#fff;border:none;border-radius:6px;cursor:pointer;margin-top:12px}
button:hover{background:#002244}
.result{margin-top:20px;padding:18px;border-radius:10px}
.high{background:#ffe0e0}
.moderate{background:#fff3cd}
.low{background:#e6f4ea}
.box{background:#f2f2f2;padding:10px;border-radius:6px;margin-top:10px}
canvas{margin-top:20px;width:100%}
small{color:#555}
</style>
</head>

<body>

<div class="container">

<h2>Virtual Neurology OPD</h2>
<p style="text-align:center">
<b>Dr Nisa Rasani</b><br>
Neurologist
</p>

<div class="box">
<b>Patient ID:</b> <span id="pid"></span>
</div>

<label>Age</label>
<input type="number" id="age">

<label>Main Symptom</label>
<select id="complaint">
  <option value="">Select</option>
  <option>Chronic Headache</option>
  <option>Sudden Weakness</option>
  <option>Speech Difficulty</option>
  <option>Seizure</option>
  <option>Numbness / Tingling</option>
</select>

<label>Duration</label>
<select id="duration">
  <option value="">Select</option>
  <option>Few Hours</option>
  <option>Few Days</option>
  <option>Several Weeks</option>
</select>

<button onclick="runAssessment()">Run Assessment</button>
<button onclick="printReferral()">Print Referral Slip</button>

<div id="output"></div>

<h3>Patient Assessment Dashboard</h3>
<canvas id="chart" height="120"></canvas>

<small>
⚠️ This tool provides clinical guidance only and does not replace physical examination or emergency care.
</small>

</div>

<script>
// ================= PATIENT ID =================
document.getElementById("pid").innerText =
  "VNOPD-" + Math.floor(Math.random()*900000+100000);

// ================= RISK ENGINE =================
function assessRisk(c,d){
  if(c==="Sudden Weakness"||c==="Speech Difficulty"||c==="Seizure")
    return {level:"HIGH RISK",css:"high"};
  if(c==="Chronic Headache"||c==="Numbness / Tingling"||d==="Several Weeks")
    return {level:"MODERATE RISK",css:"moderate"};
  return {level:"LOW RISK",css:"low"};
}

// ================= CONDITION MAP =================
function detectCondition(c){
  const map={
    "Chronic Headache":"Migraine",
    "Sudden Weakness":"Possible Stroke",
    "Speech Difficulty":"Possible Stroke",
    "Seizure":"Seizure Disorder",
    "Numbness / Tingling":"Peripheral Neuropathy"
  };
  return map[c]||"Neurological Condition";
}

// ================= DASHBOARD =================
let stats={HIGH:0,MODERATE:0,LOW:0};

function drawChart(){
  const ctx=chart.getContext("2d");
  ctx.clearRect(0,0,chart.width,chart.height);
  const data=[stats.HIGH,stats.MODERATE,stats.LOW];
  const labels=["High","Moderate","Low"];
  const colors=["#ff6b6b","#f1c40f","#2ecc71"];
  let x=40;
  data.forEach((v,i)=>{
    ctx.fillStyle=colors[i];
    ctx.fillRect(x,100-v*10,40,v*10);
    ctx.fillStyle="#000";
    ctx.fillText(labels[i],x,115);
    ctx.fillText(v,x+12,90-v*10);
    x+=100;
  });
}

// ================= MAIN =================
function runAssessment(){
  let age=ageInput.value;
  let c=complaintInput.value;
  let d=durationInput.value;

  if(!age||!c||!d){
    alert("Please complete all fields");
    return;
  }

  let risk=assessRisk(c,d);
  let condition=detectCondition(c);

  stats[risk.level.split(" ")[0]]++;
  drawChart();

  window.lastResult={age,c,condition,risk:risk.level};

  output.innerHTML=`
  <div class="result ${risk.css}">
    <b>Risk Level:</b> ${risk.level}<br><br>
    <b>Possible Condition:</b> ${condition}<br><br>
    <b>Clinical Advice:</b><br>
    ${risk.level==="HIGH RISK"
      ?"Please seek emergency medical care immediately."
      :risk.level==="MODERATE RISK"
      ?"Neurology OPD consultation is recommended."
      :"Monitor symptoms and seek care if they worsen."}
  </div>`;
}

// ================= REFERRAL SLIP =================
function printReferral(){
  if(!window.lastResult){
    alert("Please run assessment first");
    return;
  }
  let w=window.open("");
  w.document.write(`<pre>
Referral Slip
-------------------------
Patient ID: ${pid.innerText}
Age: ${lastResult.age}
Complaint: ${lastResult.c}
Condition: ${lastResult.condition}
Risk:
